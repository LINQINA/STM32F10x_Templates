# 电气基础与端口模型

## 一、为什么要建立这份文档

嵌入式/物联网系统中，大量问题并非软件Bug，而是电气行为不符合预期：

- GPIO 烧毁
- 3.3V 掉压
- 模块复位/掉线
- 供电不稳

根源几乎都可以用 **电压/电流/功率 + 电源/负载的端口行为模型** 来解释。

**目标**：在不深入电源电路设计的前提下，建立工程上够用的电气认知模型。

---

## 二、三大基本物理量

### 2.1 电压（Voltage, U）

- **含义**：电势差，推动电流的驱动力
- **单位**：伏特（V）
- **工程直觉**："给不给力"
- **关键认知**：电压本身不会造成损坏，电流才会

```
    A点 ─────────────── B点
    5V                  2V
    
    电压 = 5V - 2V = 3V（两点间的电势差）
```

### 2.2 电流（Current, I）

- **含义**：电荷的流动
- **单位**：安培（A）
- **公式**：I = Q / t

**核心认知**：
```
┌──────────────────────────────────────────────────┐
│  电流不是电源"推"的，而是负载"拉"的              │
│                                                  │
│  恒压源提供电压，负载根据自身阻抗决定拉多少电流  │
│  I = U / R                                       │
└──────────────────────────────────────────────────┘
```

### 2.3 功率（Power, P）

- **公式**：P = U × I
- **单位**：瓦特（W）
- **含义**：能量消耗/转换速率

**工程意义**：
- 发热量（P × t = 热能）
- 负载驱动能力
- 电源选型依据

---

## 三、电源与负载

### 3.1 电源（Source）

**工程抽象**：
```
电源 = 试图维持某种输出特性的能量提供者
```

常见目标：
- 维持电压（CV模式）
- 限制电流（CC模式）
- 限制功率（CP模式）

### 3.2 负载（Load）

**工程抽象**：
```
负载 = 在端口上决定"拉多少电流"的对象
```

负载不是"消耗电压"，而是通过自身阻抗特性决定 V-I 关系。

### 3.3 电路关系

```
    ┌──────────┐              ┌──────────┐
    │          │     I →      │          │
    │   电源   ├──────────────┤   负载   │
    │ (Source) │     ← I      │  (Load)  │
    │          ├──────────────┤          │
    └──────────┘              └──────────┘
    
    电源提供电压，负载决定电流，功率 = U × I
```

---

## 四、端口行为模型（CC/CV/CR/CP）

> CC/CV/CR/CP 不是器件分类，而是**端口行为模型**
> 同一个器件在不同工作区间可以呈现不同模型

### 4.1 CR — 恒阻负载（Constant Resistance）

**行为**：I = U / R（欧姆定律）

**典型器件**：
- 电阻
- 上拉/下拉电阻

**特点**：
- 线性
- 最简单、最容易分析

```
    U ↑
      │      /
      │    /
      │  /   ← 斜率 = 1/R
      │/
    ──┼──────→ I
```

### 4.2 CC — 恒流模型（Constant Current）

**行为**：I = 常数（无论电压如何变化）

**典型场景**：
- LED恒流驱动
- 电子负载CC档
- 电池充电恒流阶段

**特点**：
- 电压随环境变化
- 需要主动调节电路

```
    U ↑
      │
      │  ────────  ← I = 常数
      │
    ──┼──────────→ I
```

### 4.3 CV — 恒压模型（Constant Voltage）

**行为**：U = 常数（无论电流如何变化）

**典型场景**：
- 3.3V/5V电源轨
- LDO/稳压器输出
- USB供电

**特点**：
- 电流由负载决定
- 有电流能力上限（超过则进入CC或保护）

```
    U ↑
      │
    ──┼──────────  ← U = 常数
      │
    ──┼──────────→ I
```

### 4.4 CP — 恒功率模型（Constant Power）

**行为**：P = U × I = 常数，即 I = P / U

**典型场景**：
- DCDC输入侧
- 服务器电源负载
- 电机恒功率运行区

**特点**：
- 电压越低 → 电流越大
- **最容易拖垮电源**（低压时电流激增）

```
    U ↑
      │╲
      │  ╲
      │    ╲   ← 双曲线 U×I=P
      │      ╲
    ──┼────────→ I
```

### 4.5 模型对比表

| 模型 | 行为方程 | 典型器件 | 电压下降时电流变化 |
|------|----------|----------|-------------------|
| CR | I = U/R | 电阻 | 电流减小 |
| CC | I = 常数 | LED驱动 | 电流不变 |
| CV | U = 常数 | 稳压器 | 不适用（是电源） |
| CP | I = P/U | DCDC输入 | **电流增大** |

---

## 五、DC电源的CV/CC行为

### 5.1 基本特性

DC电源通常具备两种模式：
- **CV**（Constant Voltage）：稳压
- **CC**（Constant Current）：限流

### 5.2 自动切换机制

CV/CC不是手动切换，而是控制环路自动竞争的结果：

```
    U ↑
      │
  Uset├────────┐
      │   CV   │
      │  区域  │ CC区域
      │        └────────
      │              Iset
    ──┼──────────────────→ I

    负载电流 ≤ Iset → CV模式（电压恒定）
    负载电流 > Iset → CC模式（电压下降，电流被限制）
```

### 5.3 工程实例

```
电源标称：5V/2A

场景1：负载拉取 1A
    → CV模式，输出 5V/1A

场景2：负载拉取 3A（超过限制）
    → CC模式，输出电压下降，电流被限制在 2A
    → 负载可能工作异常
```

---

## 六、分压（串联电阻）

### 6.1 分压结构

```
    VCC
     │
    [R1]
     │
     ├──── Vout
     │
    [R2]
     │
    GND
```

### 6.2 分压公式

```
Vout = VCC × R2 / (R1 + R2)
```

### 6.3 工程用途

- 电平转换/检测
- ADC输入（将高压信号降到ADC量程内）
- 阈值判断电路
- 电压反馈采样

### 6.4 设计注意

分压电阻要考虑后级负载的影响：
```
如果 Vout 接的负载阻抗不够大，会与 R2 并联，改变分压比
```

---

## 七、限流（保护的本质）

### 7.1 限流是什么

通过增加阻抗或主动控制，限制电路中的最大电流，防止过流损坏。

### 7.2 常见方式

| 方式 | 原理 | 应用场景 |
|------|------|----------|
| 串联电阻 | R限制 I = U/R | LED限流、GPIO保护 |
| 电源CC模式 | 电源内部限流 | 过载保护 |
| 驱动芯片内限流 | 芯片内置保护 | 电机驱动、LED驱动 |
| PTC热敏电阻 | 过流发热→阻值增大 | 自恢复保险 |

### 7.3 计算实例

```
需求：3.3V GPIO 驱动 LED，期望电流 10mA，LED压降 2V

限流电阻 R = (3.3V - 2V) / 10mA = 130Ω

实际选择：150Ω 或 220Ω（留余量）
```

---

## 八、串联与并联

### 8.1 串联

```
    ──[R1]──[R2]──[R3]──
```

- 电流相等：I₁ = I₂ = I₃
- 电压分配：U总 = U₁ + U₂ + U₃
- 等效电阻：R_eq = R1 + R2 + R3

### 8.2 并联

```
       ┌──[R1]──┐
    ───┼──[R2]──┼───
       └──[R3]──┘
```

- 电压相等：U₁ = U₂ = U₃
- 电流分流：I总 = I₁ + I₂ + I₃
- 等效电阻：1/R_eq = 1/R1 + 1/R2 + 1/R3

### 8.3 两电阻并联简化公式

```
R_eq = (R1 × R2) / (R1 + R2)
```

### 8.4 分流公式

```
I₁ = V总 / R1
I₂ = V总 / R2
I3 = V总 / R3
I总 = I1 + I2 + I3
```

---

## 九、物联网/MCU系统常用抽象

### 9.1 推荐默认模型

| 对象 | 工程抽象 | 说明 |
|------|----------|------|
| 3.3V/5V电源 | CV源 | 恒压输出，有电流上限 |
| 上拉/下拉电阻 | CR负载 | 线性，I = U/R |
| GPIO输入 | 高阻抗 | 几乎不拉电流（μA级） |
| GPIO输出高 | CV源 + 内阻 | 输出VCC，有内阻限制电流 |
| GPIO输出低 | 接地 + 内阻 | 接GND，有内阻 |
| LED | 非线性负载 | 近似恒压降，不能当CR |
| DCDC输入侧 | CP负载 | 电压降→电流升，注意！ |
| LDO | CV源 | 压差→发热 |

### 9.2 GPIO输出模型

```
推挽输出高电平：
    VCC ──[Rp]──┬── GPIO Pin
                │
               OFF

推挽输出低电平：
               OFF
                │
    GND ──[Rn]──┴── GPIO Pin

Rp/Rn：输出内阻（几十Ω），限制最大输出电流
```

### 9.3 常见问题排查思路

| 现象 | 可能原因 | 排查方向 |
|------|----------|----------|
| 电压偏低 | 负载电流过大 | 测量实际电流，检查电源能力 |
| GPIO输出电压不对 | 外部负载阻抗太低 | 计算分压，检查负载 |
| 模块间歇复位 | 瞬态大电流 | 加电容，检查供电路径 |
| 芯片发烫 | 电流过大 | 检查短路，检查负载匹配 |

---

## 十、速查公式

```
欧姆定律：    U = I × R
功率公式：    P = U × I = I²R = U²/R
分压公式：    Vout = Vin × R2/(R1+R2)
串联电阻：    R_eq = R1 + R2 + ...
并联电阻：    1/R_eq = 1/R1 + 1/R2 + ...
两电阻并联：  R_eq = R1×R2/(R1+R2)
```

---

## 十一、附录：单位换算

| 前缀 | 符号 | 倍数 |
|------|------|------|
| 毫 | m | 10⁻³ |
| 微 | μ | 10⁻⁶ |
| 纳 | n | 10⁻⁹ |
| 千 | k | 10³ |
| 兆 | M | 10⁶ |

常用：
- 1A = 1000mA = 1,000,000μA
- 1kΩ = 1000Ω
- 1mW = 0.001W
